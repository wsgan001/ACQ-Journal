package prep;
import java.io.*;

import org.apache.commons.net.ftp.*;
import org.omg.PortableInterceptor.SUCCESSFUL;

import config.Config;

public class DownloadFtp {
	private String ftpHost=null;
	private String userName=null;
	private String password=null;
	private int port=-1;
	private String ftpPath=null;
	private String localpath=null;
	
	public DownloadFtp(String host, String usrname, String password, int port, String ftpPath, String localPath){
		this.ftpHost=host;
		this.userName=usrname;
		this.password=password;
		this.port=port;
		this.ftpPath=ftpPath;
		this.localpath=localPath;
	}
	
	
	public FTPClient getFTPClient(){
		FTPClient ftpClient=null;
		try {
			ftpClient=new FTPClient();
			System.out.println(1);
			ftpClient.connect(ftpHost,21);//connect to ftp
			System.out.println(2);
			ftpClient.login("anonymous", "ykai1238@hku.hk");
			System.out.println(3);
			
			int replyCode = ftpClient.getReplyCode();
		    if(!FTPReply.isPositiveCompletion(replyCode)){
		    	 System.out.println("failed ");
		      }
		    else{ 
		    	  System.out.println(ftpClient.getReplyString());
		    	  System.out.println("succeed in login");
		    	  FTPFile[] ftpFiles = ftpClient.listFiles();
					System.out.println(ftpFiles.length);
					
		    	  }
			
		} catch (Exception e) {
			// TODO: handle exception
			System.out.println("error in login");
		}
		return ftpClient;
	}
	
	
	public void downloadFile(String fileName){
		FTPClient ftpClient=null;
		try {
			ftpClient=getFTPClient();
//			ftpClient.setFileType(FTPClient.BINARY_FILE_TYPE);
			
//			ftpClient.changeWorkingDirectory(ftpPath);
			ftpClient.cwd("ftp://ftp.ncbi.nlm.nih.gov/pubmed/baseline/");
			System.out.println(ftpPath);
			FTPFile[] ftpFiles = ftpClient.listFiles();
			System.out.println(ftpFiles.length);
			System.out.println(ftpClient.listNames());
//		      for(FTPFile file : ftpFiles){
//		        System.out.println(filef);
//		        }
		      
//			File localFile = new File(localpath + fileName);  
//	        OutputStream os = new FileOutputStream(localFile);  
//	        ftpClient.retrieveFile(fileName, os);  
//	        os.close();
	        ftpClient.logout();
			
		} catch (Exception e) {
			// TODO: handle exception
			System.out.println("error");
		}		
	}
	
	public static void main(String []args){
		DownloadFtp downFtp=new DownloadFtp(Config.pubMedHost,"", "",0, Config.ftpPath, Config.localPath);
		downFtp.downloadFile("medline17n0001.xml.gz");
	}
	
}
